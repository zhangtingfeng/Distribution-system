<!DOCTYPE html>
<html>
<head>
    <script src="/Scripts/jquery-1.8.2.min.js"></script>
    <script src="/Game/GameUserID.js?version=js201709121928"></script>
    <script type="text/javascript">
        var varThisGame = "";
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>国庆贺卡</title>    <
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
          name="viewport">
    <!-- Mobile Devices Support @begin -->
    <meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
    <meta content="no-cache" http-equiv="pragma">
    <meta content="0" http-equiv="expires">
    <meta content="telephone=no, address=no" name="format-detection">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- apple devices fullscreen -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Mobile Devices Support @end -->
    <link href="./huer_files/style.css?version=css201709121928" rel="stylesheet" type="text/css">
    <script src="./huer_files/jQuery.js?version=js201709121928" type="text/javascript"></script>
    <script type="text/javascript" src="./huer_files/player_min.js?version=js201709121928"></script>
    <script type="text/javascript" src="../QueryString.js?version=js201709121928"></script>
    <script type="text/javascript">
        (function () {
            var audio = document.getElementById('bgsound');
            audio.play();
        });
    </script>
</head>
<body onload="load_Multi();">
    <input type="hidden" id="id" name="id" value="31">
    <div class="spinner" style="display: none;">
        <div class="rect1">
        </div>
        <div class="rect2">
        </div>
        <div class="rect3">
        </div>
        <div class="rect4">
        </div>
        <div class="rect5">
        </div>
    </div>
    <div class="wrapper">
        <audio id="bgsound" src="http://csoliver.eggsoft.cn/Game/005ZhongQiu/huer_files/1.mp3" autoplay="autoplay"
               loop="loop"></audio>
        <div class="css3_gif">
            <div class="moon">
                <img src="./huer_files/moon.png">
            </div>
            <div class="star_img1">
                <img src="./huer_files/star_2.png">
            </div>
            <div class="star_img2">
                <img src="./huer_files/star_1.png">
            </div>
            <div class="star_img3">
                <img src="./huer_files/star_2.png">
            </div>
            <div class="star_img4">
                <img src="./huer_files/star_1.png">
            </div>
            <div class="star_img5">
                <img src="./huer_files/star_1.png">
            </div>
            <div class="star_img6">
                <img src="./huer_files/star_1.png">
            </div>
            <div class="star_img7">
                <img src="./huer_files/star_2.png">
            </div>
            <div class="star_img8">
                <img src="./huer_files/star_1.png">
            </div>
            <div class="star_img9">
                <img src="./huer_files/star_2.png">
            </div>
            <div class="cloud_1">
                <img src="./huer_files/cloud_1.png">
            </div>
            <div class="cloud_2">
                <img src="./huer_files/cloud_2.png">
            </div>
            <div class="cloud_3">
                <img src="./huer_files/cloud_2.png">
            </div>
        </div>
        <div class="cardcontent_box">
            <div class="cardcontent_topbg">
                <img src="./huer_files/cardcontent_topbg.png">
            </div>
            <div class="cardcontent">
                <h1 class="cardFrom_id" id="MEcardFrom_id">
                    接收人
                </h1>
                <div class="cardBody_id" id="MEcardBody_id">
                    中秋思念，明月当天；快乐齐聚，人月两圆！值此花好月圆之际，祝你中秋快乐！合家团圆！
                </div>
                <p class="cardTo_id" id="MEcardTo_id">
                    发送人
                </p>
                <script type="text/javascript">
                    var men = getQueryStringByName("n");
                    if (men != "") {
                        men = decodeURI(men);
                        $("#MEcardFrom_id").html(men);
                    }

                    var mb = getQueryStringByName("b");
                    if (mb != "") {
                        mb = decodeURI(mb);
                        $("#MEcardBody_id").html(mb);
                    }
                    var mf = getQueryStringByName("f");
                    if (mf != "") {
                        mf = decodeURI(mf);
                        $("#MEcardTo_id").html(mf);
                    }
                    //alert(ddd);
                </script>
                <a href="javascript:void(0)" class="make_btn">点击定制</a>
            </div>          
        </div>
    </div>
    <div class="popup_box" style="display: none;">
        <div class="mModal">
            <a id="mymark" style="height: 1000px;" href="javascript:void(0)"></a>
        </div>
        <div class="popup_bg">
            <h2 class="popup_title">
                订制国庆贺卡文字
            </h2>
            <div class="popup_box_li">
                <input id="FromName" name="" type="text" class="popup_tobox_id" placeholder="收件人">
            </div>
            <div class="popup_box_li">
                <a href="javascript:void(0)" class="arrow_left">
                    <img src="./huer_files/arrow.png">
                </a><a href="javascript:void(0)" class="arrow_right">
                    <img src="./huer_files/arrow.png">
                </a>
                <div class="popup_bodytext_id_bg" style="display: block;" id="en">
                    <textarea name="" cols="" rows="" class="popup_bodytext_id">
                        金秋十月庆国庆，花团锦簇月正明。五谷丰登堆满墙，后庭家宴桂飘香。 国运昌盛民富强，何须奔波耕织忙。祖国江山无限好，爱国不分老与少。举国欢腾庆国庆，鲜花献给我祖国。祝伟大的祖国，繁荣富强，国运永昌!
                    </textarea>
                </div>
                <div class="popup_bodytext_id_bg" id="cn" style="display: none;">
                    <textarea name="" cols="" rows="" class="popup_bodytext_id">!</textarea>
                </div>
                <div contenteditable="true" class="popup_bodytext_id" id="en" style="display: none">
                    金秋十月庆国庆，花团锦簇月正明。五谷丰登堆满墙，后庭家宴桂飘香。 国运昌盛民富强，何须奔波耕织忙。祖国江山无限好，爱国不分老与少。举国欢腾庆国庆，鲜花献给我祖国。祝伟大的祖国，繁荣富强，国运永昌!
                </div>
                <div contenteditable="true" class="popup_bodytext_id" id="cn" style="display: none">
                    <p>
                        国庆了，没什么礼物送给你，就送你一条短信。
                    </p>
                    <p>
                        祝你年年潇洒，季季平安，月月发财，
                    </p>
                    <p>
                        天天健康，时时甜蜜，刻刻幸福，
                    </p>
                    <p>
                        分分好运，秒秒如意，辈辈成才，代代兴旺。
                    </p>
                    <p>
                        微商城
                    </p>
                </div>
            </div>
            <div class="popup_box_li">
                <input id="ToName" name="" type="text" class="popup_tobox_id" value="" placeholder="发件人">
            </div>
            <div class="btn_box">
                <a href="javascript:void(0)" class="popup_btn_id">生成贺卡</a><a href="javascript:void(0)"
                                                                             class="popup_btncancle_id">取消</a><div class="clear">
                </div>
            </div>
        </div>
    </div>
    <script>
        $(function () {
            $(".make_btn").click(function () {
                $(".popup_box").show();
            })
            $(".popup_btncancle_id").click(function () {
                $(".popup_box").hide();
            })
            $(".arrow_left,.arrow_right").click(function () {
                if ($("#en").css("display") == "block") {
                    $("#FromName").attr("placeholder", "To");
                    $("#ToName").attr("placeholder", "From");
                    $("#en").hide();
                    $("#cn").show();
                } else {
                    $("#FromName").attr("placeholder", "收件人");
                    $("#ToName").attr("placeholder", "发件人");
                    $("#en").show();
                    $("#cn").hide();
                }
            })
            $(".popup_btn_id").click(function () {
                var toName = $.trim($("#FromName").val());
                var fromName = $.trim($("#ToName").val());
                var Content = "";
                $(".popup_bodytext_id_bg").each(function () {
                    if ($(this).css("display") != "none") {
                        Content = $(this).find("textarea").val();
                    }
                })
                if (!fromName || !toName || !Content) {
                    alert("内容不能为空,请重新输入!");
                    return false;
                } else {
                    /*var strdata = {
                    action: "CreateGreetCard",
                    toName: encodeURI(toName),
                    fromName: fromName,
                    content: encodeURI(Content)
                    };*/

                    testAddAsync(10);
                    var Request = new QueryString();
                    var gameid = Request["gameid"];
                    window.location.href = "?n=" + encodeURI(toName) + "&b=" + encodeURI(Content) + "&f=" + encodeURI(fromName) + "&gameid=" + gameid;
                    do_MeGetAjaxShareWeiXin();
                    testAddAsync(1);//定制一个国庆贺卡送
                    // $.get('creat.php?t=' + Math.random(), strdata, function (res) {
                    ///    if (res != "") {
                    //      window.location.href = "index.php?n=" + toName + "&b=" + Content + "&f=" + fromName;
                    //    }
                    // })
                }
            })
        })




        var audio = document.getElementById('bgsound');
        audio.play();



    </script>
   


    <script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script>
        function load_Multi() {
            var varReturn = getUserID();
            if (varReturn > -1) {
                do_GetGameInfo();
                init();
            }
        }
        var WeiXin_shareAppAllPageTitle;
        var WeiXin_descAppPageContent;
        var WeiXin_imgAllPageUrl;

        function do_MeGetAjaxShareWeiXin() {
            var varGetPub_Agent_Path201709121928_Open_0609 = localStorage.getItem('GetPub_Agent_Path201709121928_Open_0609');
            var host = window.location.host;
            var path_AllPageLink = '';
            if ((varGetPub_Agent_Path201709121928_Open_0609 == null) || (varGetPub_Agent_Path201709121928_Open_0609 == '')) {
                path_AllPageLink = 'https://' + host + '/game/005ZhongQiu/index.html' + window.location.search;
                WeiXin_descAppPageContent = varThisGame;
            }
            else {
                var varTemp = varGetPub_Agent_Path201709121928_Open_0609;
                var varNeed = '';
                var value = varTemp.replace(/[^0-9]/ig, "");
                if (varTemp.indexOf("-") > 0) {
                    varNeed = '&parentagentid=' + value;
                } else if (varTemp.indexOf(".") > 0) {
                    varNeed = '&parentagentadid=' + value;
                }


                //debugger;
                path_AllPageLink = 'https://' + host + '/game/005ZhongQiu/index.html' + window.location.search + varNeed;
                WeiXin_descAppPageContent = localStorage.getItem('GetUserNickName201709121928_Open_0609') + varThisGame + '金秋十月庆国庆，花团锦簇月正明。';
            }
            WeiXin_imgAllPageUrl = localStorage.getItem('GetUserHeadImage201709121928_Open_0609');
            var WeiXin_lineAllPageLink = path_AllPageLink;
            WeiXin_shareAppAllPageTitle = localStorage.getItem('GetShopClientName201709121928_Open_0609') + varThisGame;
            do_GetAjaxShareWeiXin(localStorage.getItem('GetShopClientID201709121928_Open_0609'), path_AllPageLink, WeiXin_shareAppAllPageTitle, WeiXin_descAppPageContent, WeiXin_imgAllPageUrl);
        }

        function do_GetGameInfo() {
            var url = "https://Service.eggsoft.cn/User/Game_Vouchers.asmx/_GetGameInfo";
            //var url = "http://localhost/14WcfS/User/Game_Vouchers.asmx/_GetGameInfo";

            var Request = new QueryString();
            var gameid = Request["gameid"];
            url += "?gameid=" + gameid;
            //alert("do_GetGameInfo");
            var result = -1;
            $.ajax({
                type: "POST",
                url: url,
                async: false,//如果想同步 async设置为false就可以（默认是true）
                dataType: "jsonp",
                jsonp: "jsonp", //传递给请求处理程序或页面的，用以获得jsonp回调函数名的参数名(默认为:callback)
                jsonpCallback: "jsonp148566Callback", //自定义的jsonp回调函数名称，默认为jQuery自动生成的随机函数名
                contentType: "application/json; charset=utf-8",
                success: function (json) {
                    result = parseInt(json.ErrorCode);
                    if (result == 0) {
                        varThisGame = json.GameName;
                        do_MeGetAjaxShareWeiXin();
                        document.title = localStorage.getItem('GetUserNickName201709121928_Open_0609') + varThisGame;
                        document.getElementById("ToName").value = localStorage.getItem('GetUserNickName201709121928_Open_0609') + varThisGame;
                        mebtnopenurl = json.JumpURL;
                    }
                    else if (result == -2) {
                        alert("游戏已结束" + gameid);
                        varThisGame = "游戏已结束";
                        var varJumpURL = json.JumpURL;
                        window.location = (varJumpURL);
                    } else if (result == -1) {
                        varThisGame = "游戏不可用";
                        alert("游戏不可用" + gameid);
                        var varJumpURL = json.JumpURL;
                        window.location = (varJumpURL);
                    }
                    //alert(varThisGame);
                },
                error: function () {
                }
            });



            return result;
        }

    </script>
    <script type="text/javascript">
        function testAddAsync(intHowMany) {
            //SendMoneyAddAsync(intpInt_Session_CurUserID, ShopClientID, MoneyOrGouWuQuan, intmoney, strgamename)
            //从返回页面传参数过时，读取存储中的数据；
            var Request = new QueryString();
            var gameid = Request["gameid"];

            SendMoneyAddAsync(localStorage.getItem("CurUserID201709121928_Open_0609"), localStorage.getItem("GetShopClientID201709121928_Open_0609"), intHowMany, gameid); ///2是购物券
        }
    </script>
</body>
</html>
