define("wap/components/wx_image_preview",[],function(){function i(i){var t=i.attr("data-src")||i.attr("src"),e=t.replace(/!.*?\.jpg/i,"!640x320.jpg");return e}function t(i){var t,e,n=2;for(e=0;n>e;e++)if(i=i.parent(),t=i.attr("href"),t&&/[http|https|tel|mailto]:/i.test(t))return!0;return!1}function e(){var t=i($(this));s(t,[t])}var n=[],s=function(i,t){window.WeixinJSBridge&&window.WeixinJSBridge.invoke("imagePreview",{current:i,urls:t})},o={init:function(){var o=$(".js-view-image"),a=0;o.each(function(){var e=$(this),o=i(e);t(e)||e.width()>=a&&o&&(n.push(o),e.on("click",function(){s(o,n)}))}),$(".js-view-image-list").each(function(e){var n=$(this);n.on("click",".js-view-image-item",function(e){var o=n.find(".js-view-image-item");if(!t($(e.target))){o=o.map(function(){var t=$(this);return i(t)}).toArray();var a=i($(this));s(a,o)}})}),$(document.body).off("click",".js-view-single-image",e).on("click",".js-view-single-image",e)},clear:function(){n=[]}};return window.imagePreview=o,o}),define("components/zenjs/backbone/base_view",["components/zenjs/core/trigger_method"],function(i){return Backbone.View.extend({clean:function(){return this.stopListening(),this},triggerMethod:i})}),define("components/zenjs/list/list",["components/zenjs/backbone/base_view"],function(i){var t=function(){};return i.extend({initialize:function(i){return this.options=i=i||{},this.items=[],this.itemView=i.itemView,this.itemOptions=i.itemOptions||{},this.collection=i.collection,this.onAfterListChange=i.onAfterListChange||t,this.onAfterListLoad=i.onAfterListLoad||t,this.onAfterListDisplay=i.onAfterListDisplay||t,this.onListEmpty=i.onListEmpty||i.onEmptyList,this.onItemClick=i.onItemClick||t,this.onViewItemAdded=i.onViewItemAdded||t,this.displaySize=i.displaySize||-1,this.emptyHTML=i.emptyHTML||"",this.emptyText=i.emptyText||"列表为空",this.on("list:empty",_(this._onListEmpty).bind(this)),this},render:function(i){return this.displaySize=-1==(i||{}).displaySize?-1:this.displaySize,this.clean(),this._setupListeners(),this.addAll(),this.onAfterListDisplay({list:this.collection}),this},fetchRender:function(i){return this.collection.fetch({data:i,success:_(function(i,t){this.render(),this.onAfterListLoad(this.collection,t),this.onFetchSuccess&&this.onFetchSuccess()}).bind(this)}),this},_setupListeners:function(){this.collection&&(this.stopListening(this.collection),this.listenTo(this.collection,"add",this.addItem,this),this.listenTo(this.collection,"reset sort",this.render,this),this.listenTo(this.collection,"remove",this.onItemRemoved,this))},addItemListeners:function(i){var t=this;this.listenTo(i,"all",function(){var t="item:"+arguments[0],e=_.toArray(arguments);e.splice(0,1),e.unshift(t,i),this.trigger.apply(this,e),"item:click"==t&&this.onItemClick()}),this.listenTo(i.model,"change",function(){t.onAfterListChange({list:this.collection})})},addAll:function(){0===this.collection.length?this.fetching||this.triggerMethod("list:empty"):this.collection.each(function(i){this.addItem(i)},this)},removeAll:function(){for(var i=this.items.length-1;i>=0;i--)this.removeView(this.items[i]);this.onAfterListChange({list:this.collection})},addItem:function(i){if(!(this.displaySize>=0&&this.items.length>=this.displaySize)){1==this.collection.length&&(this.listEl||this.$el).html("");var t=new this.itemView(_.extend({},this.options.itemOptions,{model:i,index:this.collection.indexOf(i)}));return this.items.push(t),this.addItemListeners(t),t.render(),this.onViewItemAdded({list:this.items,viewItem:t}),(this.listEl||this.$el).append(t.el),t}},removeItem:function(i){var t=this.getViewByModel(i);t&&this.removeView(t)},removeView:function(i){var t;this.stopListening(i),i&&(this.stopListening(i.model),i.remove(),t=this.items.indexOf(i),this.items.splice(t,1)),0===this.collection.length&&(this.fetching||this.triggerMethod("list:empty"))},onItemRemoved:function(i){this.removeItem(i),this.onAfterListChange()},getViewByModel:function(i){return _.find(this.items,function(t,e){return t.model===i})},dispatchEventToAllViews:function(i,t){for(var e=this.items.length-1;e>=0;e--)this.items[e].trigger(i,t)},remove:function(){i.prototype.remove.call(this,arguments),this.removeAll(),this.collection.reset(),delete this.collection},clean:function(){i.prototype.clean.call(this,arguments),this.removeAll(),(this.listEl||this.$el).html(""),this.stopListening(this.collection)},_onListEmpty:function(){this.$el.html(this.emptyHTML||(this.emptyText?'<p style="text-align:center;line-height:60px;">'+this.emptyText+"</p>":""))}})}),window.Utils=window.Utils||{},$.extend(window.Utils,{getCdnImageUrl:function(i,t){return i?(t=i.match(/.+\!\d+x\d+.+/)?"":t&&t.length>0?t:"!100x100.jpg",i.match(/https?:\/\//i)?i+t:window._global.url.imgqn+"/"+i+t):window._global.url.cdn_static+"/image/wap/no_pic.png"}}),define("wap/components/util/kdt",function(){}),define("text!wap/showcase/offline_shop/templates/infoWindow_content.html",[],function(){return'<div class="infoWindow-content">\n    <div class="address"><%= address %></div>\n    <div class="navi">\n        <a class="tag">\n            到这里去\n        </a>\n        <div class="js-navi-to navi-to"></div>\n    </div>\n</div>\n'}),define("wap/showcase/offline_shop/views/map_marker_item",["text!wap/showcase/offline_shop/templates/infoWindow_content.html"],function(i){var t=window.zenjs.UA;return Backbone.View.extend({initialize:function(t){this.options=t,this.map=t.map,this.markerClickHandler=_(t.markerClickHandler).bind(this)||function(){},this.markerAdded=!1,this.address=this.model.get("area")+this.model.get("address"),this.lng=this.model.get("lng"),this.lat=this.model.get("lat"),this.lat&&this.lng&&(this.Point=new BMap.Point(this.lng,this.lat),this.shopMarker=new BMap.Marker(this.Point),this.infoWindowContentHtml=_.template(i)({address:this.address}),this.infoWindow=new BMap.InfoWindow(this.infoWindowContentHtml,{width:t.infoWindowWidth||220,height:t.infoWindowHeight||80,title:this.model.get("name"),offset:t.infoWindowOffset||{width:0,height:15},enableAutoPan:t.enableAutoPan}),this.infoWindow.addEventListener("open",_(this.onInfoWindowOpen).bind(this)),this.shopMarker.addEventListener("click",_(this.onMarkerClicked).bind(this)))},render:function(){},onInfoWindowOpen:function(){var i=$(".js-navi-to");i.on("click",_(this.onNaviToClicked).bind(this))},onNaviToClicked:function(i){zenjs.UA.isWeixin()?(window.location.hash="id/"+this.model.get("id"),t&&window.showGuide("browser",{isIOS:t.isIOS()})):window.location.href="http://map.baidu.com/mobile/webapp/search/search/qt=s&wd="+this.address+"/?third_party=uri_api"},onMarkerClicked:function(){return this.openInfoWindow(),!!this.markerClickHandler&&this.markerClickHandler(this.model),this},showPlaceInMap:function(){return this.shopMarker&&!this.markerAdded&&(this.map.addOverlay(this.shopMarker),this.onMarkerClicked(),this.markerAdded=!0),this},openInfoWindow:function(){return this.infoWindow&&!this.infoWindow.isOpen()?(this.shopMarker.openInfoWindow(this.infoWindow),this):void 0},getPoint:function(){return this.Point}})}),define("text!wap/showcase/offline_shop/templates/offline_shop_detail.html",[],function(){return'<div class="name-card name-card-3col name-card-store clearfix">\n    <a href="javascript:;" class="thumb js-view-image-list">\n        <% if(image && image.length > 0){ %>\n            <img class="js-view-image-item" src="<%= getCdnImageUrl(image[0]) %>">\n        <% } %>\n    </a>\n    <a href="tel:<%= phone1 + phone2 %>"><div class="phone"></div></a>\n    <div class="detail">\n        <h3>\n            <%= area + address %>\n        </h3>\n\n        <p class="c-gray-dark ellipsis" style="margin-top: 1px">\n        <% if (business_hours) { %>\n            营业时间：<%= business_hours %><br>\n        <% } %>\n            电话：<%= phone1 + phone2 %>\n        </p>\n\n    </div>\n</div>\n'}),require(["wap/components/wx_image_preview","components/zenjs/list/list","wap/components/util/kdt","wap/showcase/offline_shop/views/map_marker_item","text!wap/showcase/offline_shop/templates/offline_shop_detail.html"],function(i,t,e,n,s){function o(i){m.html(p(_.extend(i.toJSON(),{getCdnImageUrl:window.Utils.getCdnImageUrl})))}i.init();var a=$("#js-map");if(a.length){var h=$(window).width(),l=$(window).height();a.width(h).height(l-90),window.navigator.userAgent.indexOf("iPhone OS 7")>0&&$("#js-view-all").addClass("hide");var r=new BMap.Map(a[0],{enableMapClick:!1,enableHighResolution:!1});r.addControl(new BMap.ZoomControl);var d=window._global.shop,c=new Backbone.Collection(window._global.shop_list),m=$("#shop-detail-container"),p=_.template(s),f=new t({itemView:n,collection:c,itemOptions:{map:r,markerClickHandler:o}}).render(),w=function(i){var t=f.getViewByModel(i),e=t.getPoint();if(e)r.centerAndZoom(e,17),t.showPlaceInMap();else{var n=i.get("area");r.centerAndZoom(n,11),o(i),motify.log("门店: "+i.get("name")+" 地理位置未指定",-1)}},u=Backbone.Router.extend({routes:{"":"default","id/:id":"openBdMap"},"default":function(){var i=c.get(d.id);w(i)},openBdMap:function(i){var t=c.get(i);if(!zenjs.UA.isWeixin()&&window.location.hash){var e=t.get("area")+t.get("address");window.location.href="http://map.baidu.com/mobile/webapp/search/search/qt=s&wd="+e+"/?third_party=uri_api"}else w(t)}});new u;Backbone.history.start(),$("#js-view-all").on("click",function(){var i=!1,t=[];return function(){motify.clear(),i||(_.each(f.items,function(i){var e=i.getPoint();e&&(i.showPlaceInMap(),t.push(e))}),i=!0),t.length>0?r.setViewport(r.getViewport(t)):motify.log("所有门店都未指定地理位置",-1)}}())}}),define("main",function(){});